#!/usr/bin/env bash -vx
#
# If no config, everything is in this directory
DEF_HOME=$(dirname $(readlink -m  $0))

DEF_CONFIG=DEFAULT-BDRC-AT-CONFIG.sh

# Must be the same path that auditTool-config.sh writes to
CONFIG=${HOME}/.config/bdrc/auditTool/config

if [[  -f ${CONFIG} ]] ; then
    . ${CONFIG}
else if [[ -f ${DEF_HOME}/${DEF_CONFIG} ]] ; then
    . ${DEF_HOME}/${DEF_CONFIG}
else
    echo "Configuration and default configurations are missing. Please contact BDRC for support."
fi
fi

#
export LOG_PROPS=${CONFIG_ATHOME}/log4j2.properties
#
# This is the system itself. Do not change it
shellJar=${CONFIG_SHELL_JAR_FILE}

extlib=~/bin/am/install

# shellJar was built to point to its own mainclass
# In Java 9, you cant add a dynamically loaded jar file to a classpath.
# So we need to use the -cp syntax, so that the tests can locate their imageio dependencies in the test library
#
java -cp "${shellJar}:${CONFIG_TEST_LIB_JAR_FILE}:lib/*" -DtestJar=${CONFIG_TEST_LIB_JAR_FILE} -DatHome=${CONFIG_ATHOME} -Dlog4j.configurationFile=${LOG_PROPS}  io.bdrc.am.audit.shell.shell $@